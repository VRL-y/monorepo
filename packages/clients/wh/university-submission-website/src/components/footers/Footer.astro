---
import { getCollection } from "astro:content";
import Container from "@/components/primitives/Container.astro";
import Link from "@/components/primitives/Link.astro";
import { getLocalizedSettings } from "@/lib/localization-helpers";
import { translatePath, unlocalizedUrl } from "@/lib/localization-helpers";
import { defaultLocale, locales } from "site";

const currentLocale = Astro.currentLocale;

const { footer } = getLocalizedSettings(currentLocale);

function getTranslatedUrl(locale: string): string {
    const unlocalizedPath = unlocalizedUrl(Astro.url.pathname);
    return translatePath(locale, unlocalizedPath);
}

function isActiveLocale(locale: string): boolean {
    return locale === currentLocale;
}

const pages = await getCollection("pages");
const posts = await getCollection("posts");

// get main pages for navigation
const topInfoPages = pages
    .map((page) => {
        const [lang, ...slug] = page.slug.split("/");
        return {
            ...page,
            lang: lang,
            slug: page.slug.startsWith("/") ? page.slug : `/${page.slug}`,
        };
    })
    .filter(
        (page) =>
            page.lang === currentLocale && page.data.type === "informational"
    )
    .slice(0, 4);

const lastPosts = posts
    .map((page) => {
        const [lang, ...slug] = page.slug.split("/");
        return {
            ...page,
            lang: lang,
            slug: translatePath(
                lang,
                `/post${unlocalizedUrl(`/${page.slug}`)}`
            ),
        };
    })
    .filter((page) => page.lang === currentLocale)
    .sort(
        (a, b) =>
            new Date(b.data.lastUpdateDate).getTime() -
            new Date(a.data.lastUpdateDate).getTime()
    )
    .slice(0, 6);
---

<div
    class="flex flex-col justify-end bg-black px-4 pb-10 pt-16 text-sm font-medium lg:px-20">
    <Container>
        <div class="w-full flex-col items-center">
            <div class="flex flex-col items-center justify-center text-white">
                <h3
                    class="max-w-4xl text-center text-4xl leading-normal lg:text-6xl"
                    set:html={footer.title}
                />
                <div class="mt-8">
                    {
                        footer?.buttons?.map(({ text, url }) => (
                            <Link
                                href={url}
                                style="buttonLight"
                                icon="iconamoon:arrow-top-right-1-thin">
                                {text}
                            </Link>
                        ))
                    }
                </div>
            </div>
            <div
                class="mt-16 grid auto-cols-fr grid-cols-1 grid-rows-[auto] gap-10 lg:grid-cols-[1fr_1fr_1fr]">
                <div class="col-span-1 row-span-1">
                    <div
                        class="mb-5 flex items-center gap-x-[0.63rem] font-semibold uppercase text-white">
                        <div
                            class="flex items-center rounded-3xl border-2 border-solid border-white px-5 py-3">
                            <div>Navigation</div>
                        </div>
                    </div>
                    <div class="mt-10">
                        <div class="flex flex-col items-start gap-[0.63rem]">
                            <p
                                class="mb-3 border-b-2 border-solid border-white pb-1 text-lg text-white">
                                Main Pages
                            </p>
                            <ul class="mb-3 list-none text-white/[0.65] space-y-1">
                                {
                                    topInfoPages.map(
                                        ({ data: { title }, slug }) => (
                                            <li>
                                                <a href={slug} class="hover:text-white transition-colors">
                                                    {title}
                                                </a>
                                            </li>
                                        )
                                    )
                                }
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-span-1 row-span-1">
                    <div
                        class="mb-5 flex items-center gap-x-[0.63rem] font-semibold uppercase text-white">
                        <div
                            class="flex items-center rounded-3xl border-2 border-solid border-white px-5 py-3">
                            <div>Recent Posts</div>
                        </div>
                    </div>
                    <div class="mt-10">
                        <div class="flex flex-col items-start gap-[0.63rem]">
                            <p
                                class="mb-3 border-b-2 border-solid border-white pb-1 text-lg text-white">
                                Latest Insights
                            </p>
                            <ul class="mb-3 list-none text-white/[0.65] space-y-1">
                                {
                                    lastPosts.map(
                                        ({ data: { title }, slug }) => (
                                            <li>
                                                <a href={slug} class="hover:text-white transition-colors text-sm">
                                                    {title}
                                                </a>
                                            </li>
                                        )
                                    )
                                }
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-span-1 row-span-1 text-white">
                    <div
                        class="mb-5 flex items-center gap-x-[0.63rem] font-semibold uppercase">
                        <div
                            class="flex items-center rounded-3xl border-2 border-solid border-white px-5 py-3">
                            <div>About</div>
                        </div>
                    </div>
                    <div class="mt-10 text-sm">
                        <div class="flex flex-col items-start">
                            <p class="text-white/[0.78] leading-relaxed">
                                This blog documents my journey through risk management concepts, from traditional frameworks to antifragility. 
                                A personal exploration of uncertainty, resilience, and strategic thinking.
                            </p>
                            <div class="mt-4">
                                <p class="text-xs text-white/[0.65]">
                                    University submission website<br/>
                                    Educational purposes only
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mt-16">
                <div class="flex items-center justify-between gap-4">
                    <p class="text-base text-white/[0.78]">
                        {footer.copyright}
                    </p>
                    <div class="flex gap-4">
                        {
                            locales.map((locale) => (
                                <a
                                    href={getTranslatedUrl(locale)}
                                    class:list={[
                                        "relative flex cursor-pointer items-center justify-start gap-4 overflow-hidden",
                                        isActiveLocale(locale)
                                            ? "rounded-md bg-white px-2 py-1 text-black"
                                            : "text-white",
                                    ]}>
                                    <span class="text-md xs:text-lg overflow-hidden md:text-xl">
                                        <span>{locale}</span>
                                    </span>
                                </a>
                            ))
                        }
                    </div>
                    <div class="flex gap-5 text-sm">
                        <div class="flex flex-col gap-2 text-white/[0.65]">
                            <p class="font-medium text-white">Legal & Disclaimer:</p>
                            <p class="text-xs leading-relaxed max-w-md">
                                This website is created for university submission purposes only. 
                                All content represents personal academic exploration and should not be considered professional advice. 
                                No warranties or representations are made regarding the accuracy of information presented.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </Container>
</div>

<slot />
